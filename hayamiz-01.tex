% -*- coding: utf-8 -*-

\chapter{Hadoopつかったら負けかなと思ってる}

\begin{flushright}
はやみず
\end{flushright}

最初に断っておきたいのですが，
この記事はHadoopを貶めることを意図したものではありません。
一方で，それではタイトル詐欺かというと，やはり「Hadoop使ったら負けかな」と思っていることも事実です。
この一見すると矛盾するような主張を切り口として，
昨今の大規模データ処理に関わる技術について，その現状に切り込んでゆきたいと思います。

\section{MapReduceとHadoop}

2012年現在，大規模なデータ処理に関わる技術者のなかで，
MapReduceあるいはHadoopという言葉を聞いたことがない方はいないでしょう。

MapReduceは2004年にGoogleによって提唱された，
大規模データを並列分散処理するためのフレームワークです。
Googleは実際に社内でMapReduceを使っていたらしいですが，
当時も今もそのソフトウェア自体は公開されておらず，
誰もがMapReduceを使える状況にはありませんでした。

その状況を変えたのがHadoopです。
端的に言うと，HadoopとはJavaによるMapReduceの実装です。
もともとは，Apache Nutchという全文検索エンジン基盤のために実装され始めたHadoopですが，
2006年にApache Hadoopとして独立したプロジェクトとなり，
そしてNutchの開発者が米Yahoo!に移籍してからHadoopプロジェクトを立ち上げ，
その完成度を高めていきました。
もともとはMapReduceを出発点として開発が始まったHadoopですが，
Hadoop分散ファイルシステム(HDFS)の上でMapReduce以外の方法でデータ処理を行うことも可能であり，
現在においてはかならずしも「単なるMapReduceの実装」として見るのが正しいとはいえません。
むしろ，MapReduceを核として発展した，
並列分散データ処理のためのソフトウェアエコシステムというのが，
現在におけるHadoopの姿であるといえるでしょう。

\section{データベース業界からのMapReduc批判}

2009年，Web上にある記事が公開されて大きな話題を呼びました。
``MapReduce: A major step backwards'' と題されたその記事は，
当時のクラウドコンピューティングブームも相まって大流行していたMapReduce(あるいはHadoop)を痛烈に批判するものでした。
日本語にするならば「MapReduce: 大きな技術的後退」となるでしょうか。
タイトルからして挑戦的なその記事は，手厳しくMapReduceのことを批判しています。

記事の中に要点のリストがあるので，拙訳とともに引用します：

\begin{quote}
\begin{enumerate}
 \item A giant step backward in the programming paradigm for large-scale data intensive applications \\
	   大規模データインテンシブアプリケーションにおけるプログラミングパラダイムの大いなる後退
 \item A sub-optimal implementation, in that it uses brute force instead of indexing \\
	   索引を使わない総当り方式の，およそ最善とは言いがたい実装
 \item Not novel at all -- it represents a specific implementation of well known techniques developed nearly 25 years ago \\
	   全く新規性に欠ける -- 25年近く前に開発された手法の限定的な実装でしかない
 \item Missing most of the features that are routinely included in current DBMS \\
	   現代のDBMSがごく当たり前に持っている機能の殆どが欠けている
 \item Incompatible with all of the tools DBMS users have come to depend on \\
	   DBMSユーザが使っているツールのほとんど全てと互換性がない
\end{enumerate}
\end{quote}

この記事を書いたのはDavid J. DeWitt と Michael Stonebraker \footnote{RDBMSを世界で最初に実装したStonebrakerの功績は The Database Times vol.1 を参照のこと}の2人です。
この2人は，データベース分野において最も権威ある賞の1つである SIGMOD Edgar Codd Award を共に受賞しており，
まさにデータベース業界を代表する大御所2人といっても過言ではありません。
その2人からこれだけ厳しい言葉で批判されたわけですから，
MapReduceとHadoopはデータベース業界自体から手厳しい批判を受けたことになります。

「大いなる後退」「およそ最善とは言いがたい実装」「全く新規性に欠ける」「機能が欠けている」
などなど，実に厳しい言葉を並べてMapReduceが批判されており，
さながら「MapReduceなんていうのはデータベース業界からすればオモチャでしかない」
とでも言いたげです。

彼らの言い分は理解できます。
DeWittやStonebrakerだけでなく，
データベース業界の人々はMapReduceが登場する何十年も前から並列データベースシステムの研究に取り組み，
並列分散データ処理に関して非常に高度な技術を開発し，積み重ねてきました。
それらに比べると，MapReduceはよく言うとシンプルな，
悪く言うとお馬鹿な方法で，\bou{とりあえず}並列分散データ処理ができる方法と位置づけられます。
多くの研究者により連綿と研ぎ澄まされてきた並列データベース技術の歴史を飛び越して，
MapReduceのようなある意味``下品''な方法論が世に広く受け入れられている状況は，
データベース業界からすると決して面白いものではなかったのでしょう。
その意味でいくと，
この記事は「我々の技術のほうが優れているはずなのに」
という DeWitt と Stonebraker の壮大な負け惜しみのようにも思えてきます。

\begin{figure}[t]
\begin{screen}
 \noindent{\sf コラム：歴史は繰り返す？}
 \vspace*{3mm}

 ある時点における業界の権威達が「こんなものはオモチャだ」と批判した技術が，
 やがて世を席巻し，権威を飲み込んでしまう。
 これはクリステンセンのいう{\em イノベーションのジレンマ}であり，
 コンピュータの歴史においてたびたび繰り返されてきました。

 たとえばデータベース史を振り返ると，
 Edgar F. Coddが提唱し，
 Michael Stonebraker がINGRESプロジェクトで世界で初めて実装したリレーショナルデータベースは，
 当時のデータベース業界の巨人であるIBMからはまさにオモチャ扱いされていました。
 リレーショナルデータベースを提唱したCoddがIBMの研究者であったのは歴史の皮肉ともいえるでしょう。
 メインフレームマシンに階層型データベースが主流である時代に，
 DECのミニコン上で動く処理性能の低いリレーショナルデータベースは，
 IBMからすればまさにオモチャ以外の何者でもなかったのかもしれません。
 しかし，ユーザの利便性において大きくまさるリレーショナルデータベースが徐々にその勢いをましてゆき，
 ついにはIBMもリレーショナルデータベース市場へと舵を切らざるをえないと判断をするに至りました。

 リレーショナルデータベースの黎明期には「オモチャだ」と批判される側にいたStonebrakerが，
 今度はMapReduceを「オモチャだ」と批判する側にまわっているのが面白いですね。
 ただ，Stonebrakerのすごいところは単に批判するだけではなく，
 そこから新たなものを生み出してきてしまうことです。
 あるとき「NoSQLはリレーショナルデータベースより速い」という主張を手厳しく批判したStonebrakerは，
 そのしばらく後にOLTP向けの爆速DBMSであるVoltDBをつくりだしてしまいました。
\end{screen}
\end{figure}

ただし，MapReduceをオモチャだと揶揄するような彼らの批判は，
しかしながら歴史に裏付けされた確かな技術論の上で語られています。
確かにHadoopは流行にのって広く普及するには至りましたが，
彼らが指摘する欠点を補う方向へと進化をしてきているのです。

\section{MapReduceの先へ}

MapReduceの欠点の1つを端的に言うと，
{\em 正規化されていないデータ}が入力として突っ込まれて，
そしてそのデータを処理するためにプログラマが{\em 手続きを与える}必要があることです。

いやいや，もともとGoogleではWebのクローラが取得してきたデータを前処理するため等々，
そういった正規化されていないデータに対して手続きを与えるだけで並列分散処理できるように作られたのがMapReduceなんだよ，
と思われる方もいるかもしれません。
それはそれで正しいのですが，今日においてHadoopは並列データ処理基盤として期待されており，
そのためには{\em 正規化されていないデータ}と{\em 手続きを与える}という要素は非常なマイナスポイントなのです。

「プログラマがデータ処理の{\em 手続き}を与え」なければならないということは，
DeWittとStonebrakerが指摘するように，
歴史的に見て非常に大きな「後戻り」なのです。
なぜならば，現在のデータベースにおけるすべての始まりといっても過言ではない，
Edgar F. Codd によるリレーショナルデータベースの提唱は，
他でもない「手続きからの解放」を目指したものだったからです。




\section{Big Dataの波に乗って}
